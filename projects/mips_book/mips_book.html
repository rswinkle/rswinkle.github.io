<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Robert Winkler">
<title>MIPS Assembly Programmming</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>MIPS Assembly Programmming</h1>
<div class="details">
<span id="author" class="author">Robert Winkler</span><br>
<span id="email" class="email"><a href="mailto:rob121618@gmail.com">rob121618@gmail.com</a></span><br>
<span id="revnumber">version 0.7,</span>
<span id="revdate">2021-06-15</span>
<br><span id="revremark">First Draft</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_info">Info</a></li>
<li><a href="#_chapter_0_hello_world">Chapter 0: Hello World</a>
<ul class="sectlevel2">
<li><a href="#_prereqs">Prereqs</a></li>
<li><a href="#_system_setup">System Setup</a></li>
<li><a href="#_hello_world">Hello World</a></li>
<li><a href="#_building_and_running">Building and Running</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapter_1_data">Chapter 1: Data</a>
<ul class="sectlevel2">
<li><a href="#_arrays">Arrays</a></li>
</ul>
</li>
<li><a href="#_chapter_2_system_calls">Chapter 2: System Calls</a>
<ul class="sectlevel2">
<li><a href="#_examples">Examples</a></li>
</ul>
</li>
<li><a href="#_chapter_3_branches_and_logic">Chapter 3: Branches and Logic</a>
<ul class="sectlevel2">
<li><a href="#_practice">Practice</a></li>
<li><a href="#_conclusion_2">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapter_4_loops">Chapter 4: Loops</a>
<ul class="sectlevel2">
<li><a href="#_looping_through_arrays">Looping Through Arrays</a></li>
<li><a href="#_conclusion_3">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapter_5_functions_and_the_mips_calling_convention">Chapter 5: Functions and the MIPS Calling Convention</a>
<ul class="sectlevel2">
<li><a href="#_functions">Functions</a></li>
<li><a href="#_the_convention">The Convention</a></li>
<li><a href="#_conclusion_4">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapter_6_floating_point_types">Chapter 6: Floating Point Types</a>
<ul class="sectlevel2">
<li><a href="#_floating_point_registers_and_instructions">Floating Point Registers and Instructions</a></li>
<li><a href="#_practice_2">Practice</a></li>
<li><a href="#_getting_floating_point_literals">Getting Floating Point Literals</a></li>
<li><a href="#_branching">Branching</a></li>
<li><a href="#_functions_2">Functions</a></li>
<li><a href="#_conclusion_5">Conclusion</a></li>
</ul>
</li>
<li><a href="#_chapter_7_tips_and_tricks">Chapter 7: Tips and Tricks</a>
<ul class="sectlevel2">
<li><a href="#_formatting">Formatting</a></li>
<li><a href="#_misc_general_tips">Misc. General Tips</a></li>
<li><a href="#_constants">Constants</a></li>
<li><a href="#_macros">Macros</a></li>
<li><a href="#_switch_case_statements">Switch-Case Statements</a></li>
<li><a href="#_command_line_arguments">Command Line Arguments</a></li>
</ul>
</li>
<li><a href="#_references_and_useful_links">References and Useful Links</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_info">Info</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&#169; Robert Winkler 2021</p>
</div>
<div class="paragraph">
<p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a>.</p>
</div>
<div class="paragraph">
<p>This book is available online in both</p>
</div>
<div class="paragraph">
<p>+
<a href="http://www.robertwinkler.com/projects/mips_book/mips_book.html">HTML</a> and</p>
</div>
<div class="paragraph">
<p>+
<a href="http://www.robertwinkler.com/projects/mips_book/mips_book.pdf">PDF</a> form.</p>
</div>
<div class="paragraph">
<p>The repo for the book, where you can get the code referenced report errors
is here (TODO)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_0_hello_world">Chapter 0: Hello World</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In which we lay the groundwork for the rest of the book&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_prereqs">Prereqs</h3>
<div class="paragraph">
<p>While someone with no programming experience could probably learn MIPS from this
book, it is definitely preferable to have at least some experience in a higher
level imperative programming language. I say imperative, because programming
in assembly is the antithesis of functional programming, everything is about
state, with each line changing the state of the CPU and sometimes memory. Given
that, experience in functional languages like Lisp, Scheme etc. are less helpful
than experience in C/C++, Java, Python, Javascript etc.</p>
</div>
<div class="paragraph">
<p>Of all of the latter, C is the best, with C being a close second because at least
all of C exists in C. There are many reasons C is the best prior experience when
learning assembly (any assembly, not just MIPS), including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pointers, concepts and symmetry of "address of" and "dereference" operators</p>
</li>
<li>
<p>pointer/array syntax equivalence</p>
</li>
<li>
<p>Stack allocation as the default</p>
</li>
<li>
<p>manual memory management, no garbage collector</p>
</li>
<li>
<p>Global data</p>
</li>
<li>
<p>Rough equivalence in structure of a C program and an assembly program (vs. say Java)</p>
</li>
<li>
<p>Pass by value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;s some overlap between those and there&#8217;s probably more but you can see than
most other languages that are commonly taught as first languages are missing most if
not all of those things.</p>
</div>
<div class="paragraph">
<p>Even C, which technically has all of them, being a superset of C, is usually taught in
a way that mostly ignores all of those things.  They teach C as if it&#8217;s Java,
never teaching the fundamentals. In any case this is getting into
my problems with CS pedagogy of the last 20 years based on my experience as a CS
major myself ('12) and as a programming tutor helping college students across the
country since 2016, and I should save it for a proper essay/rant sometime.</p>
</div>
<div class="paragraph">
<p>Long story short, I use C code and C syntax to help explain and teach MIPS.  I&#8217;ll
try to provide enough explanation regardless of past experience as best I can.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_setup">System Setup</h3>
<div class="paragraph">
<p>As I tell all of my tutoring students, if you&#8217;re majoring in CS or anything related
I highly recommend you use Linux. It&#8217;s just easier in every way to do dev work
on Linux vs Windows or Mac.  Many assignments require it, which often necessitates
using a virtual machine (which is painful, especially on laptops) and/or ssh-ing
into a school Linux server, which is also less than ideal.  In general, you&#8217;ll have
to learn how to use the unix terminal eventually and will probably use it to some
extent in your career so it also just makes sense to get used to it asap.</p>
</div>
<div class="paragraph">
<p>That being said, Windows does now have WSL so you can get the full Ubuntu or Debian
or Fedora etc. terminal based system on Windows without having to setup a real
virtual machine (or dealing with the slowdown that would cause). I&#8217;ve even heard
that they&#8217;ll get support for Linux GUI programs soon.</p>
</div>
<div class="paragraph">
<p>Mac on the other hand is technically a Unix based system and you can use their
terminal and install virtually any program from there using Macports or Homebrew
or similar.</p>
</div>
<div class="paragraph">
<p>There are 3 commonly used MIPS simulators that I know of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SPIM is probably the oldest and is terminal only</p>
</li>
<li>
<p>QtSpim is a GUI front end for SPIM</p>
</li>
<li>
<p>MARS is a Java GUI based simulator with dozens of extra syscalls, syntactic
sugar and features like graphics, memory mapped I/O, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SPIM and QtSpim are in the Debian/Ubuntu repos so you can install them with the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ sudo apt install qtspim spim</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can probably find them in the repos for other distros too and install them similarly.</p>
</div>
<div class="paragraph">
<p>If it&#8217;s not in your repos or you&#8217;re on Windows (and not using WSL) or Mac you can
download them, and MARS at these addresses</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://courses.missouristate.edu/KenVollmar/mars/download.htm">MARS</a></p>
</li>
<li>
<p><a href="https://sourceforge.net/projects/spimsimulator/files/">QtSpim</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_hello_world">Hello World</h3>
<div class="paragraph">
<p>Let&#8217;s start with the classic hello world program, first in C, then in MIPS, and go
over all the pieces in overview.  You can copy paste these into your editor of choice
(mine being neovim), or just use the files in the associated repo to follow along.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;stdio.h&gt;</span><span class="tok-cp"></span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Hello World!</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s pretty self explanatory.  You have to include stdio.h so you can use the function printf
(though in the real world I&#8217;d use puts here), the function main is the start of any C/C++
program, which is a function that returns an int.  We call printf to display the string
"Hello World!\n" to the user and then return 0 to exit.  0 indicates success, no error btw.</p>
</div>
<div class="paragraph">
<p>You can compile and run it in a linux/unix terminal with as show below.  You
can substitute clang or another compiler for gcc if you want.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ gcc -o hello hello.c
$ ./hello
Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, the same program in MIPS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span>.data
hello:   .asciiz &quot;Hello World!\n&quot;

.text
main:
	li   $v0, 4      # print string system call
	la   $a0, hello  # load address of string to print into a0
	syscall

	li   $v0, 10     # exit syscall
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>.data</code> section is where you declare global variables, which includes string
literals as in this case.  We&#8217;ll cover them in more detail later.</p>
</div>
<div class="paragraph">
<p>The <code>.text</code> section is where any code goes.  Here we declare a single label main
indicating the start of our main function.</p>
</div>
<div class="paragraph">
<p>We then put the number 4 in the $v0 register to select the print string system call.
It takes one argument, the address of the string to print, in the $a0 register which we
do on the next line. Finally, we call the system call using the syscall instruction.
Finally we call the exit system call which takes no arguments and exits the program.
Again we&#8217;ll cover system calls in a later chapter, this is just an intro/overiew.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_and_running">Building and Running</h3>
<div class="paragraph">
<p>Now that we have our hello world MIPS program, how do we run it?  Well the easiest
and quickest<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> way is of course to do it on the command line, which can be done like
this for spim:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ spim -file hello.s
SPIM Version <span class="tok-m">8</span>.0 of January <span class="tok-m">8</span>, <span class="tok-m">2010</span>
Copyright <span class="tok-m">1990</span>-2010, James R. Larus.
All Rights Reserved.
See the file README <span class="tok-k">for</span> a full copyright notice.
Loaded: /usr/lib/spim/exceptions.s
Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>or this for MARS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ java -jar ~/Mars4_5.jar hello.s
MARS <span class="tok-m">4</span>.5  Copyright <span class="tok-m">2003</span>-2014 Pete Sanderson and Kenneth Vollmar

Hello World!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of your MARS jar file may be different<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>,
but just use the correct name and path.  For me I just keep the jar file in my home
directory so I can use tilde to access it no matter where I am.  You can also just
copy it into your working directory (ie wherever you have your source code) so you
don&#8217;t have to specify a path at all.  There are lots of useful command line options
that you can use<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>, some of which we&#8217;ll touch on later.</p>
</div>
<div class="paragraph">
<p>Running the jar directly on the command line works even in the DOS command line though
I&#8217;ve never done it and it&#8217;s probably not worth it.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can just start up MARS or QtSpim like a normal GUI application and
then load your source file.  MARS requires you to hit "assemble" then "run", whereas
QtSpim, you just hit "run".</p>
</div>
<div class="paragraph">
<p>QtSpim does let you start and load the file in one step from the command line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ qtspim hello.s</code></pre>
</div>
</div>
<div class="paragraph">
<p>but there is no way to simply run it with out starting the GUI, which makes sense
since the whole point is to be a GUI wrapper around spim.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>Well, there you have it, you&#8217;ve written and run your first MIPS program.  Another
few chapters and you&#8217;ll have no trouble with almost anything you&#8217;d want to do
in in MIPS for a class or just for fun with these simulators.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_1_data">Chapter 1: Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In MIPS, you can declare global variables in the <code>.data</code> section.</p>
</div>
<div class="paragraph">
<p>At a minimum this is where you would declare/define any literal strings
your program will be printing, since virtually every program has
at least 1 or 2 of those.</p>
</div>
<div class="paragraph">
<p>When declaring something in the <code>.data</code> section, the format is</p>
</div>
<div class="paragraph">
<p><code>variable_name: .directive value(s)</code></p>
</div>
<div class="paragraph">
<p>where whitespace between the 3 is arbitrary.  The possible directives are listed
in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. MIPS data types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directive</th>
<th class="tableblock halign-left valign-top">Size</th>
<th class="tableblock halign-left valign-top">C equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.half</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.ascii</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char str[5] = "hello"; (no '\0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.asciiz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char str[] = "hello"; (includes the '\0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">typeless, unitinialized space, can be used for any type/array</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see it&#8217;s pretty straightforward, but there are a few more details
about actually using them so let&#8217;s move onto some examples.</p>
</div>
<div class="paragraph">
<p>Say you wanted to convert the following simple program to MIPS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;stdio.h&gt;</span><span class="tok-cp"></span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
	<span class="tok-kt">char</span> <span class="tok-n">name</span><span class="tok-p">[</span><span class="tok-mi">30</span><span class="tok-p">];</span>
	<span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-p">;</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;What&#39;s your name and age?</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>
	<span class="tok-n">scanf</span><span class="tok-p">(</span><span class="tok-s">&quot;%s %d&quot;</span><span class="tok-p">,</span> <span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">age</span><span class="tok-p">);</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Hello %s, nice to meet you!</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">,</span> <span class="tok-n">name</span><span class="tok-p">);</span>
	<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing you have to remember is that when converting from a higher level
language to assembly (any assembly) is that what matters is whether it&#8217;s functionally
the same, not that everything is done in exactly the same way.  In this instance,
that means realizing that your literal strings and the name array become globals in
MIPS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><pre><span></span>.data
age:         .word 0  # can be initialized to anything

ask_name:    .asciiz &quot;What&#39;s your name and age?\n&quot;
hello_space: .asciiz &quot;Hello &quot;
nice_meet:   .asciiz &quot;, nice to meet you!\n&quot;

name:        .space 30

.text

# main goes here
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the example, we just extract all the string literals and
the character array name and declare them as MIPS globals.  One thing to note
is the second printf.  Because it prints a variable, name, using the conversion
specifier, we break the literal into pieces around that.  Since there is no
built-in printf function in MIPS, you have to handle printing variables yourself
with the appropriate system calls.</p>
</div>
<div class="sect2">
<h3 id="_arrays">Arrays</h3>
<div class="paragraph">
<p>Declaring arrays is just an extension of declaring single variables.  Obviously
strings are special cases, that can be handled with <code>.ascii</code> or <code>.asciiz</code> for literals,
but for other types or user inputed strings how do we do it?</p>
</div>
<div class="paragraph">
<p>Well the first way, which was demonstrated in the snippet above is to use <code>.space</code>
to just declare array of the necessary byte size.  Keep in mind that the size is
specified in bytes not elements, so it only matches for character arrays.  For
arrays of ints/words, floats, doubles etc. you&#8217;d have to multiply by the sizeof(type).</p>
</div>
<div class="paragraph">
<p>"But, <code>.space</code> only lets you declare uninitialized arrays, how do I do initialized ones?"</p>
</div>
<div class="paragraph">
<p>Well, it&#8217;s just an extension of declaring a single variable of that type.  You specify
all the values, comma separated.  This actually gives you another way to declare a string
or a character array, though I can&#8217;t really think of a reason you&#8217;d want to.  You could
declare a <code>.byte</code> array and list all the characters individually.  See below for examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-p">[</span><span class="tok-mi">20</span><span class="tok-p">];</span>
<span class="tok-kt">double</span> <span class="tok-n">b</span><span class="tok-p">[</span><span class="tok-mi">20</span><span class="tok-p">];</span>
<span class="tok-kt">int</span> <span class="tok-n">c</span><span class="tok-p">[</span><span class="tok-mi">10</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-mi">9</span><span class="tok-p">,</span><span class="tok-mi">8</span><span class="tok-p">,</span><span class="tok-mi">7</span><span class="tok-p">,</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">0</span> <span class="tok-p">};</span>
<span class="tok-kt">char</span> <span class="tok-n">d</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-sc">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-sc">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-sc">&#39;c&#39;</span> <span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span>.data
a:        .space 80
b:        .space 160
c:        .word 9,8,7,6,5,4,3,2,1,0
d:        .byte &#39;a&#39;, &#39;b&#39;, &#39;c&#39;
</pre></td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_2_system_calls">Chapter 2: System Calls</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We mentioned system calls (aka syscalls from now on) in chapter 0 when we were
going over our "Hello World" program, but what exactly are they?</p>
</div>
<div class="paragraph">
<p>Essentially, they are the built in functions of a operating system, in this case,
the simple operating system of the MIPS simulators.  They provide access to all the
fundamental features, like input and output to/from both the console and files,
allocating memory, and exiting.  That covers all the 17 syscalls supported by spim,
but MARS supports many more, for things from playing MIDI sounds, to getting a random
number, to creating GUI dialogs.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Except for the MARS or SPIM specific chapters/sections, I&#8217;ll be sticking to code
compatible with both throughout this book, meaning we only use the first 17 syscalls,
and don&#8217;t get to use some of the syntactic sugar available in MARS, or any SPIM
specific features either.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. MIPS data types</caption>
<colgroup>
<col style="width: 18.75%;">
<col style="width: 6.25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">$v0</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = integer to print</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f12 = float to print</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f12 = double to print</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = address of string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = integer read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f0 = float read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f0 = double read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = address of input buffer<br>
$a1 = buffer size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">works like C&#8217;s fgets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sbrk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = size in bytes to allocate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = address of allocated memory (sbrk is basically malloc but there is no free)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">program terminates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = character to print (ascii value)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = character read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">open file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = address of filename<br>
$a1 = flags<br>
$a2 = mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = file descriptor (negative if error)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read from file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = file descriptor<br>
$a1 = address of input buffer<br>
$a2 = max characters to read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = number of characters read, 0 for end-of-file, negative for error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">write to file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = file descriptor<br>
$a1 = address of output buffer<br>
$a2 = number of characters to write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0 = number of characters written, negative for error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">close file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = file descriptor</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exit2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0 = termination result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">program terminates, returning number in $a0 (only meaningful when run in the terminal, ignored in GUI)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see you it&#8217;s just the basics.  You can read or write the different types,
cdo file I/O using calls identical to POSIX functions (open, read, write, close;
see man pages), allocate memory, and exit.  Even so, they&#8217;re sufficient to build
anything you want.</p>
</div>
<div class="paragraph">
<p>So, what does that table mean?  How do these actually work?</p>
</div>
<div class="paragraph">
<p>The process is, put the number for the syscall you want in $v0, fill in the appropriate
arguments, if any, and then do the syscall:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><pre><span></span>	li    $v0, 1  # 1 is print integer
	li    $a0, 42  # takes 1 arg in a0, the number to print
	syscall        # actually execute syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can think of the above as <code>print_integer(42);</code>.  Let&#8217;s look at an actual
program that uses a few more syscalls next.</p>
</div>
<div class="sect2">
<h3 id="_examples">Examples</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><pre><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;stdio.h&gt;</span><span class="tok-cp"></span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
	<span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-p">;</span>
	<span class="tok-kt">int</span> <span class="tok-n">height</span><span class="tok-p">;</span>
	<span class="tok-kt">char</span> <span class="tok-n">name</span><span class="tok-p">[</span><span class="tok-mi">50</span><span class="tok-p">];</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;What&#39;s your name? &quot;</span><span class="tok-p">);</span>
	<span class="tok-n">fgets</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">,</span> <span class="tok-mi">50</span><span class="tok-p">,</span> <span class="tok-n">stdin</span><span class="tok-p">);</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Hello %s&quot;</span><span class="tok-p">,</span> <span class="tok-n">name</span><span class="tok-p">);</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;How old are you? &quot;</span><span class="tok-p">);</span>
	<span class="tok-n">scanf</span><span class="tok-p">(</span><span class="tok-s">&quot;%d&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">age</span><span class="tok-p">);</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter your height in inches: &quot;</span><span class="tok-p">);</span>
	<span class="tok-n">scanf</span><span class="tok-p">(</span><span class="tok-s">&quot;%d&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">height</span><span class="tok-p">);</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Your age + height = %d</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-o">+</span> <span class="tok-n">height</span><span class="tok-p">);</span>

	<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;m using <code>fgets()</code> instead of <code>scanf("%s", name)</code> because fgets works the same as the
read string syscall (8).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><pre><span></span>.data

name:     .space 50

nameprompt:  .asciiz &quot;What&#39;s your name? &quot;
hello_space: .asciiz &quot;Hello &quot;
how_old:     .asciiz &quot;How old are you? &quot;
ask_height:  .asciiz &quot;Enter your height in inches: &quot;
ageplusheight: .asciiz &quot;Your age + height = &quot;


.text
main:
	li   $v0, 4      # print string system call
	la   $a0, nameprompt  # load address of string to print into a0
	syscall

	li   $v0, 8      # read string
	la   $a0, name
	li   $a1, 50
	syscall

	li   $v0, 4
	la   $a0, hello_space
	syscall

	la   $a0, name  # note 4 is still in $v0
	syscall

	# don&#39;t print a newline here because
	# one will be part of name

	li   $v0, 4
	la   $a0, how_old
	syscall

	li   $v0, 5   # read integer
	syscall
	move $t0, $v0  # save age in t0

	li   $v0, 4
	la   $a0, ask_height
	syscall

	li   $v0, 5   # read integer
	syscall
	add  $t0, $t0, $v0 # t0 += height


	li   $v0, 4
	la   $a0, ageplusheight
	syscall

	li   $v0, 1  # print int
	move $a0, $t0  # a0 = age + height
	syscall

	# print newline
	li   $v0, 11   # print char
	li   $a0, 10   # ascii value of &#39;\n&#39;
	syscall


	li   $v0, 10     # exit syscall
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There a few things to note from the example.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t declare global variables for age or height.  We could, but there&#8217;s no reason
to since we have to have them in registers to do the addition anyway.  So we just
copy/save height to $t0 so we can use $v0 for overwrite $v0 for 2 more syscalls,
then add age to t0.</p>
</div>
<div class="paragraph">
<p>This is generally how it works.  Use registers for local variables unless
required to do otherwise.  We&#8217;ll cover more about register use when we
cover the MIPS calling convention.</p>
</div>
<div class="paragraph">
<p>Another thing is when we print their name, we don&#8217;t put 4 in $v0 again because it
is still/already 4 from the lines above.  Unless the syscall says it writes to $v0
you can assume it is unmodified.</p>
</div>
<div class="paragraph">
<p>Lastly, many people will declare a string <code>"\n"</code> and use print string to print a newline,
but it&#8217;s easier to just use the print char syscall as we do just before exiting.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_3_branches_and_logic">Chapter 3: Branches and Logic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can&#8217;t go much farther in our MIPS programming journey without covering branching.
Almost every non-trivial program requires some logic, even if it&#8217;s just a few if or
if-else statements.  In other words, almost every program requires branching, a way
to do code a instead of code b, or to do code a only if certain conditions are met.</p>
</div>
<div class="paragraph">
<p>You already know how do do this in higher level languages, the aforementioned if
statement.  In assembly it&#8217;s more complicated.  Your only tool is the ability
to jump to a label on other line based on the result of various comparisons.  The
relevant instructions are listed in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. MIPS branching related instructions (and pseudoinstructions)</caption>
<colgroup>
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Opcode</th>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch On Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beq rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs == rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch On Not Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bne rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs != rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch Less Than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blt rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs &lt; rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch Greater Than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bgt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bgt rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs &gt; rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch Less Than Or Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ble rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs &#8656; rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch Greater Than Or Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bge rs, rt, label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs &gt;= rt) goto label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Less Than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slt rd, rs, rt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = (rs &lt; rt) ? 1 : 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Less Than Immediate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slt rd, rs, imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = (rs &lt; imm) ? 1 : 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Less Than Immediate Unsigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sltiu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slt rd, rs, imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = (rs &lt; imm) ? 1 : 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Less Than Unsigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sltu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sltu rd, rs, imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd = (rs &lt; imm) ? 1 : 0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can see the same information and more (like which ones are pseudoinstructions)
on the MIPS greensheet.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
<div class="paragraph">
<p>There are additional pseudoinstructions in the form of beq/bne/blt/bgt/ble/bge + 'z' which
are just shortcuts to compare a register against 0, ie the 0 register.</p>
</div>
<div class="paragraph">
<p>So the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	beq     $t0, $0, label
	bne     $t1, $0, label
	blt     $t2, $0, label</pre>
</div>
</div>
<div class="paragraph">
<p>would be equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	beqz    $t0, label
	bnez    $t1, label
	bltz    $t2, label</pre>
</div>
</div>
<div class="paragraph">
<p>Note <code>$0</code> is the same as <code>zero</code> and is just the hard coded 0 register.  I&#8217;ll cover
registers in more detail in the chapter on functions and the calling conventions.</p>
</div>
<div class="paragraph">
<p>One final thing is that labels have the same naming requirements as C variables and functions.
They must start with a letter or underscore and the rest can be letters, underscores, digits.</p>
</div>
<div class="sect2">
<h3 id="_practice">Practice</h3>
<div class="paragraph">
<p>The rest of this chapter will be going over many examples, looking at snippets
of code in C and translating them to MIPS.</p>
</div>
<div class="sect3">
<h4 id="_basics">Basics</h4>
<div class="paragraph">
<p>Let&#8217;s start with the most basic if statement.  The code in and after
the if statement is arbitrary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">a</span><span class="tok-o">++</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-n">a</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now in MIPS, let&#8217;s assume that a is in <code>$t0</code>.  The tranlation would look
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	ble   $t0, $0, less_eq_0    # if (a &lt;= 0) goto less_eq_0
	addi  $t0, $t0, 1           # a++
less_eq_0:
	sll   $t0, $t0, 1           # a *= 2  (shifting left by n is multiplying by 2^n)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few things to note in this example.  The first is that in assembly
we test for the opposite of what was in the if statement.  This will always be
the case when jumping forward because (if we want to keep the same order of code)
we can only jump <em>over</em> a block of code, whereas in C we fall into the block if
the condition is true.  In the process of mentally compiling a bit of C to
assembly, it can be helpful to some to change to jump based
logic first.  For example the previous C would become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">less_eq_0</span><span class="tok-p">;</span>
	<span class="tok-n">a</span><span class="tok-o">++</span><span class="tok-p">;</span>
<span class="tok-nl">less_eq_0</span><span class="tok-p">:</span>
	<span class="tok-n">a</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is obviously still valid C but matches the branching behavior of assembly
exactly.  You can see I put comments for the equivalent C code in my assembly;
it helps with readability to comment every line or group of lines that way.</p>
</div>
<div class="paragraph">
<p>The second thing to notice is how we handled the multiplication.  This has
nothing to do with branching but is something we&#8217;ll touch on multiple times
throughout the book.  Your job when being a human compiler is to match the
<em>behavior</em>, you are under no obligation to match the structure or operations
of the higher level code exactly (unless your professors stupidly forces you to).</p>
</div>
<div class="paragraph">
<p>Given that, it is in your best interest to change and rearrange things in
order to simplify the assembly as much as possible to make your life easier.
Generally speaking this also tends to result in more performant code, since
using fewer instructions and fewer branches (the most common outcomes) saves
execution time.</p>
</div>
<div class="paragraph">
<p>In this case, the standard <code>mult</code> instruction (from the green sheet) would have
required 3 instructions, and even the <code>mul</code> instruction (that does seem to
be supported everywhere but is not on the green sheet) would take 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><pre><span></span>	li    $t1, 2
	mult  $t0, $t1
	mflo  $t0           # a *= 2

	# or

	li    $t1, 2
	mul   $t0, $t0, $t1   # a *= 2
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that, when multiplying or dividing by a power of 2 it&#8217;s common practice,
and just common sense, to use <code>sll</code> or <code>sra</code>.  This is true in all assembly
languages because multiplication (and division) is a relatively costly operation
so using shifts when you can saves performance even if you didn&#8217;t actually save
instructions.</p>
</div>
<div class="paragraph">
<p>Ok, let&#8217;s look at an if-else example.  Again the actual code is arbitrary and
we&#8217;re assuming a and b are in <code>$t0</code> and <code>$t1</code> respectively</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
		<span class="tok-n">b</span> <span class="tok-o">-=</span> <span class="tok-mi">50</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could do it something like these two ways</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><pre><span></span>	bgt    $t0, $0, greater_0   # if (a &gt; 0) goto greater_0
	addi   $t1, $t1, -50        # b -= 50
	j      less_eq_0
greater_0:
	li     $t1, 100             # b = 100
less_eq_0:

	# or

	ble    $t0, $0, less_eq0     $ if (a &lt;= 0) goto less_eq_0
	li     $t1, 100             # b = 100
	j      greater_0
less_eq_0:
	addi   $t1, $t1, -50        # b -= 50
greater_0:
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how the first swaps the order of the actual code which keeps the
actual conditions the same as in C, while the second does what we discussed
before and inverts the condition in order keep the the blocks in the same
order.  In both cases, an extra unconditional branch and label is necessary
so we don&#8217;t fall through the else case.  This is inefficient and wasteful,
not to mention complicates the code unecessarily.  Remember how our job
is to match the behavior, not the exact structure?  Imagine how we could
rewrite it in C to simplify it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-n">b</span> <span class="tok-o">-=</span> <span class="tok-mi">50</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>which becomes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	addi   $t1, $t1, -50        # b -= 50;
	ble    $t0, $0, less_eq_0   # if (a &lt;= 0) goto less_eq_0
	li     $t1, 100             # b = 100
less_eq_0:
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is just one simple example of rearranging code to make your life easier.
In this case, we are taking advantage of what the code is doing to make a
default path or default case.  Obviously, because of the nature of the code
subtracting 50 has to be the default because just setting b to 100 loses
the original value in case we were supposed to subtract 50 instead.  In cases
where you can&#8217;t avoid destructive changes (like where the condition and the
code are using/modifying the same variable), you can use a temporary variable;
i.e. copy the value into a spare register.  You still save yourself an unecessary
jump and label.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compound_conditions">Compound Conditions</h4>
<div class="paragraph">
<p>These first 2 examples have been based on simple conditions, but what if you
have compound conditions?  How does that work with branch operations that only
test a single condition?  As you might expect, you have to break things down
to match the logic using the operations you have.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at <code>and</code> first.  Variables a, b, and c are in t0, t1, and t2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">10</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">a</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">c</span> <span class="tok-o">+=</span> <span class="tok-mi">20</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-n">b</span> <span class="tok-o">&amp;=</span> <span class="tok-mh">0xFF</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>So what&#8217;s our first step?  Well, just like previous examples we need to test
for the opposite when we switch to assembly, so we need the equivalent of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">10</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">a</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-p">))</span>
		<span class="tok-k">goto</span> <span class="tok-n">no_add20</span><span class="tok-p">;</span>
	<span class="tok-n">c</span> <span class="tok-o">+=</span> <span class="tok-mi">20</span><span class="tok-p">;</span>
<span class="tok-nl">no_add20</span><span class="tok-p">:</span>
	<span class="tok-n">b</span> <span class="tok-o">&amp;=</span> <span class="tok-mh">0xFF</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, that didn&#8217;t help us much, we still don&#8217;t know how to handle that compound
condition.  In fact we&#8217;ve just made it more complicated.  If only there were
a way to convert it to or instead of and.  Why would we want that?  Because,
while both and&#8217;s and or&#8217;s in C allow for short circuit evaluation (where
the result of the whole expression is known early and the rest of expression
is not evaluated), with or, it short circuits on success while and short
circuits on failure.  What does that mean?  It means that with or, the whole
expression is true the second a single true term is found, while with and
the whole expression is false the second a single false term is found.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following code to demonstrate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">||</span> <span class="tok-n">b</span> <span class="tok-o">||</span> <span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">something</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-c1">// What does this actually look like if we rewrote it to show what it&#39;s</span>
	<span class="tok-c1">// actually doing with short circuit evaluation?</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-k">goto</span> <span class="tok-n">dont_do_something</span><span class="tok-p">;</span>

<span class="tok-nl">do_something</span><span class="tok-p">:</span>
	<span class="tok-n">something</span><span class="tok-p">;</span>

<span class="tok-nl">dont_do_something</span><span class="tok-p">:</span>

	<span class="tok-c1">// You can see how the first success is all you need:</span>
	<span class="tok-c1">// Compare that with and below</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">b</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">something</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-p">{</span>
				<span class="tok-n">something</span><span class="tok-p">;</span>
			<span class="tok-p">}</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>
	<span class="tok-c1">// which in jump form is</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">a_true</span><span class="tok-p">;</span>
	<span class="tok-k">goto</span> <span class="tok-n">failure</span><span class="tok-p">;</span>
<span class="tok-nl">a_true</span><span class="tok-p">:</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">b_true</span><span class="tok-p">;</span>
	<span class="tok-k">goto</span> <span class="tok-n">failure</span><span class="tok-p">;</span>

<span class="tok-nl">b_true</span><span class="tok-p">:</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-nl">c_true</span><span class="tok-p">:</span>
	<span class="tok-k">goto</span> <span class="tok-n">failure</span><span class="tok-p">;</span>

<span class="tok-nl">c_true</span><span class="tok-p">:</span>
	<span class="tok-n">something</span><span class="tok-p">;</span>
<span class="tok-nl">failure</span><span class="tok-p">:</span>

	<span class="tok-c1">// Man that&#39;s ugly and overcomplicated and hard to read</span>
	<span class="tok-c1">// But what if we did this instead:</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">dont_do_something</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">dont_do_something</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-k">goto</span> <span class="tok-n">dont_do_something</span><span class="tok-p">;</span>

	<span class="tok-n">something</span><span class="tok-p">;</span>

<span class="tok-nl">dont_do_something</span><span class="tok-p">:</span>

	<span class="tok-c1">// Clearly you need all successes for and.  In other words</span>
	<span class="tok-c1">// to do and directly, you need state, knowledge of past</span>
	<span class="tok-c1">// successes.  But what about that second translation of and?</span>
	<span class="tok-c1">// It looks a lot like or?</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re exactly right.  That final translation of and is exactly like or.</p>
</div>
<div class="paragraph">
<p>It takes advantage of De Morgan&#8217;s laws.<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>  For those
of you who haven&#8217;t taken a Digital Logic course (or have forgotten), De
Morgan&#8217;s laws are 2 equivalencies, a way to an or to an and and vice versa.</p>
</div>
<div class="paragraph">
<p>They are (in C notation):</p>
</div>
<div class="paragraph">
<p><code>!(A || B) == !A &amp;&amp; !B</code></p>
</div>
<div class="paragraph">
<p><code>!(A &amp;&amp; B) == !A || !B</code></p>
</div>
<div class="paragraph">
<p>Essentially you can think of it as splitting the not across the terms and changing
the logical operation.  The law works for arbitrary numbers of terms, not just 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(A &amp;&amp; B &amp;&amp; C)
is really
((A &amp;&amp; B) &amp;&amp; C)
so when you apply De Morgan's Law recursively you get:
!((A &amp;&amp; B) &amp;&amp; C) == !(A &amp;&amp; B) || !C == !A || !B || !C</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s apply the law to our current example.  Of course the negation of comparisons
is just covering the rest of the number line so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span> <span class="tok-o">||</span> <span class="tok-n">a</span> <span class="tok-o">&gt;=</span> <span class="tok-n">b</span><span class="tok-p">))</span>
		<span class="tok-k">goto</span> <span class="tok-n">no_add20</span><span class="tok-p">;</span>
	<span class="tok-n">c</span> <span class="tok-o">+=</span> <span class="tok-mi">20</span><span class="tok-p">;</span>
<span class="tok-nl">no_add20</span><span class="tok-p">:</span>
	<span class="tok-n">b</span> <span class="tok-o">&amp;=</span> <span class="tok-mh">0xFF</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>which turns into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span>	li     $t9, 10
	ble    $t0, $t9, no_add20      # if (a &lt;= 10) goto no_add20
	bge    $t0, $t1, no_add20      # if (a &gt;= b)  goto no_add20

	addi   $t2, $t2, 20            # c += 20
no_add20:
	andi   $t1, $t1, 0xFF          # b &amp;= 0xFF
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>See how that works?  Or&#8217;s do not need to remember state.  Just the fact that
you reached a line in a multi-term or expression means the previous checks
were false, otherwise you&#8217;d have jumped.  If you tried to emulate the same
thing with an and, as you saw in the larger snippet above, you&#8217;d need a
bunch of extra labels and jumps for each term.</p>
</div>
<div class="paragraph">
<p>What about mixed compound statements?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">10</span> <span class="tok-o">||</span> <span class="tok-n">c</span> <span class="tok-o">&gt;</span> <span class="tok-mi">100</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">b</span> <span class="tok-o">&gt;=</span> <span class="tok-n">c</span><span class="tok-p">)</span>
		<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;true</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>

	<span class="tok-n">b</span> <span class="tok-o">|=</span> <span class="tok-mh">0xAA</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, the first thing to remember is that <code>&amp;&amp;</code> has a higher priority than <code>||</code>,
which is why most compilers these days will give a warning for the above code
about putting parenthesis around the <code>&amp;&amp;</code> expression to show you meant it (even
though it&#8217;s completely legal as is).</p>
</div>
<div class="paragraph">
<p>So with that in mind, let&#8217;s change it to jump format to better see what we
need to do.  While we&#8217;re at it, let&#8217;s apply De Morgan&#8217;s law to the <code>&amp;&amp;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-mi">10</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">do_true</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">c</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_if</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">b</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_if</span><span class="tok-p">;</span>
<span class="tok-nl">do_true</span><span class="tok-p">:</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;true</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>

<span class="tok-nl">done_if</span><span class="tok-p">:</span>
	<span class="tok-n">b</span> <span class="tok-o">|=</span> <span class="tok-mh">0xAA</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This one is trickier because we don&#8217;t flip the initial expression like normal.
Instead of jumping <em>over</em> the body which would require testing for the opposite,
we jump to the true case.  We do this because we don&#8217;t want to have multiple
print statements and it lets us fall through the following conditions.  We would
need multiple print statements because failure for the first expression <em>is not</em>
failure for the entire expression.  Here&#8217;s how it would look otherwise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">check_and</span><span class="tok-p">;</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;true</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">done_if</span><span class="tok-p">;</span>
<span class="tok-nl">check_and</span><span class="tok-p">:</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">c</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_if</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">b</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_if</span><span class="tok-p">;</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;true</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">);</span>

<span class="tok-nl">done_if</span><span class="tok-p">:</span>
	<span class="tok-n">b</span> <span class="tok-o">|=</span> <span class="tok-mh">0xAA</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is harder to read and has both an extra print and an extra jump.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s convert the better version to MIPS (a,b,c = t0, t1, t2):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><pre><span></span>.data
true_str: .asciiz &quot;true\n&quot;

.text
	li    $t8, 10   # just get the necessary literals in some unused regs
	li    $t9, 100

	bgt   $t0, $t8, do_true   # if (a &gt; 10) goto do_true
	ble   $t2, $t9, done_if   # if (c &lt;= 100) goto done_if
	blt   $t1, $t2, done_if   # if (b &lt; c) goto done_if

do_true:
	li    $v0, 4           # print string
	la    $a0, true_str    # address of str in a0
	syscall

done_if:
	ori   $t1, $t1, 0xAA   # b |= 0xAA
</pre></td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_if_else_chain">If-Else Chain</h4>
<div class="paragraph">
<p>Ok, let&#8217;s look at a larger example.  Let&#8217;s say you&#8217;re trying to determine
a student&#8217;s letter grade based on their score.  We&#8217;re going to need a chain
of if-else-if&#8217;s to handle all cases.  Assume <code>score</code> is declared and
set somewhere before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">char</span> <span class="tok-n">letter_grade</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">score</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">90</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">letter_grade</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">score</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">80</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">letter_grade</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;B&#39;</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">score</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">70</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">letter_grade</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;C&#39;</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">score</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">60</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">letter_grade</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;D&#39;</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
		<span class="tok-n">letter_grade</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;F&#39;</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;You got a %c</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">,</span> <span class="tok-n">letter_grade</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>With chains like these, you following everything we&#8217;ve learned before, it
comes out looking like this (assuming score is t0 and letter_grade is t1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><pre><span></span>.data
grade_str: .asciiz &quot;You got a &quot;

.text
	li     $t1, 70   # letter_grade default to &#39;F&#39; ascii value

	li     $t2, 90
	blt    $t0, $t2, not_a   # if (score &lt; 90) goto not_a
	li     $t1, 65           # leter_grade = &#39;A&#39;
	j      grade_done

not_a:
	li     $t2, 80
	blt    $t0, $t2, not_b   # if (score &lt; 80) goto not_b
	li     $t1, 66           # leter_grade = &#39;B&#39;
	j      grade_done

not_b:
	li     $t2, 70
	blt    $t0, $t2, not_c   # if (score &lt; 70) goto not_c
	li     $t1, 67           # leter_grade = &#39;C&#39;
	j      grade_done

not_c:
	li     $t2, 60
	blt    $t0, $t2, grade_done   # if (score &lt; 60) goto grade_done
	li     $t1, 68           # leter_grade = &#39;D&#39;

grade_done:
	li     $v0, 4      # print str
	la     $a0, grade_str
	syscall

	li     $v0, 11     # print character
	move   $a0, $t1    # char to print
	syscall

	move   $a0, 10    # print &#39;\n&#39;
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how we set a default value and then test for the opposite
of each condition to jump to the next test, until we get one that fails
(aka was true in the original C condition) and set the appropriate grade.</p>
</div>
<div class="paragraph">
<p>You can arrange chains like this in either direction, it doesn&#8217;t have to match
the order of the C code.  As long as it works the same, do whatever makes the
code simpler and more sensible to you.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph">
<p>Branching and logic and learning to translate from higher level code to assembly
is something that just takes a lot of practice but eventually it&#8217;ll become
second nature.  We&#8217;ll get more practice in the chapter on looping which naturally
also involves branching.</p>
</div>
<div class="paragraph">
<p>One final note, there&#8217;s really no reason to use the <code>slt</code> family of opcodes <em>unless</em>
your professor requires it, ie he says you can&#8217;t use pseudoinstructions so you&#8217;re
left with <code>beq</code>, <code>bne</code>, <code>j</code> and the <code>slt</code> ops.  I&#8217;ll show how you can code without
using pseudoinstructions in a later chapter.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_4_loops">Chapter 4: Loops</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
"Insanity is doing the same thing over and over again and expecting different results."
</blockquote>
<div class="attribution">
&#8212; Unknown<br>
<cite>Often misattributed to Albert Einstein</cite>
</div>
</div>
<div class="paragraph">
<p>Before we get into the MIPS, I want to cover something that may be obvious to some but
may have never occurred to others.  Any loop structure can be converted to any other
(possibly with the addition of an if statement).  So a for can be written as a while
and vice versa.  Even a do-while can be written as a for or while loop.  Let&#8217;s look
at some equivalencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">a</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">do_something</span><span class="tok-p">;</span>
		<span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">do</span> <span class="tok-p">{</span>
			<span class="tok-n">do_something</span><span class="tok-p">;</span>
			<span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">;</span>
		<span class="tok-p">}</span> <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
	<span class="tok-c1">// you could also have an if (i &gt;= a) goto loop_done; to jump over do-while</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>I think in general, when writing assembly, it can help to think more in terms of while or
do-while rather than for because the former more resemble what the assembly looks like
in terms of what goes where.  So just like in the last chapter, we would think of the
if-else statements in "jump-form" or "branch-form", we can do the same here, converting
for to while in our head as an intermediary step before going to assembly.</p>
</div>
<div class="paragraph">
<p>Speaking of "jump-form", lets apply it to the loop above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&gt;=</span> <span class="tok-n">a</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_loop</span><span class="tok-p">;</span>
<span class="tok-nl">loop</span><span class="tok-p">:</span>
	<span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-n">i</span><span class="tok-o">++</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">loop</span><span class="tok-p">;</span>

<span class="tok-nl">done_loop</span><span class="tok-p">:</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how that starts to look more like assembly.  Another thing to note is that
unlike with if statements where we test for the opposite to jump over the block of code,
when you&#8217;re doing the test for a loop at the bottom, like a do-while loop, it is unchanged
from C, because you are jumping to continue the loop.  If you put the test at the top it
becomes inverted, and you put an unconditional jump at the bottom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-nl">loop</span><span class="tok-p">:</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&gt;=</span> <span class="tok-n">a</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">done_loop</span><span class="tok-p">;</span>
	<span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-n">i</span><span class="tok-o">++</span>
	<span class="tok-k">goto</span> <span class="tok-nl">loop</span><span class="tok-p">:</span>

<span class="tok-nl">done_loop</span><span class="tok-p">:</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In general it&#8217;s better to test at the bottom, both because it&#8217;s closer to C with the matching
condition, and because, when you know the loop is going to execute at least once, it requires
only one jump + label, rather than 2 because you can forgo the the initial if check:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-mi">10</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
		<span class="tok-n">do_something</span><span class="tok-p">;</span>

	<span class="tok-c1">// becomes</span>

	<span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-nl">loop</span><span class="tok-p">:</span>
	<span class="tok-n">do_something</span><span class="tok-p">;</span>
	<span class="tok-n">i</span><span class="tok-o">++</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">loop</span><span class="tok-p">;</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok, now that we&#8217;ve got the theory and structure out of the way, let&#8217;s try doing a simple
one in MIPS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-mi">100</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s about as basic as it gets, add up 1 to 99.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span>	li    $t0, 0   # sum = 0
	li    $t1, 1   # i = 1  we can start at 1 because obviously adding 0 is pointless
	li    $t2, 100
loop:
	addi  $t0, $t0, $t1    # sum += i
	addi  $t1, $t1, 1      # i++
	blt   $t1, $t2, loop   # while (i &lt; 100)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok I don&#8217;t think there&#8217;s much point in doing any more without getting to what loops
are most often used for, looping through data structures, most commonly arrays.</p>
</div>
<div class="sect2">
<h3 id="_looping_through_arrays">Looping Through Arrays</h3>
<div class="paragraph">
<p>Looping and arrays go together for obvious reasons.  An array a sequence of
variables of the same type, almost always related in some way.  Naturally you
want to operate on them all together in various ways; sorting, searching,
accumulating, etc.  So in this section we&#8217;ll cover looping through arrays in
various ways, and dealing with multi-dimentional arrays.</p>
</div>
<div class="sect3">
<h4 id="_1d_arrays">1D Arrays</h4>
<div class="paragraph">
<p>Let&#8217;s pretend there&#8217;s an array <code>int numbers[10];</code> filled with 10 random numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span> <span class="tok-n">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-mi">10</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">total</span> <span class="tok-o">+=</span> <span class="tok-n">numbers</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">];</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several ways to do this.  The first is the most literal translation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><pre><span></span>	li    $t0, 0     # total = 0
	li    $t1, 0     # i = 0
	la    $t2, numbers   # t2 = numbers
	li    $t3, 10
sum_loop:
	sll   $t4, $t1, 2    # t4 = i*sizeof(int) == i*4
	add   $t4, $t4, $t2  # t4 = &amp;numbers[i]
	lw    $t4, 0($t4)    # t4 = numbers[i]
	add   $t0, $t0, $t4  # total += numbers[i]

	addi  $t1, $t1, 1    # i++
	blt   $t1, $t3, sum_loop   # while (i &lt; 10)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we initialize the relevant variables before hand (numbers and 10 could be set
every iteration but that&#8217;s less efficient).  Now what&#8217;s with the i*4?  We already
discussed using shifts to multiply and divide by powers of 2 in a previous chapter,
but here we&#8217;re doing something that higher level languages do automatically for you
every time you do an array access.  When you access the i&#8217;th element, under the hood
it is multiplying i by the size of the type of the array and adding that number of
bytes to the base address and then loading the element located there.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re unfamiliar with the C syntax in the comments, &amp; means "address of", so t4
is being set to the address of the i&#8217;th element.  Actually that C syntax is redundant
because the the &amp; counteracts the brackets.  In C adding a number to a pointer does
pointer math (ie it multiplies by the size of the items as discussed above).  This
means that these 2 expressions are equivalent:</p>
</div>
<div class="paragraph">
<p><code>&amp;numbers[i] == numbers + i</code></p>
</div>
<div class="paragraph">
<p>also</p>
</div>
<div class="paragraph">
<p><code>&amp;numbers[0] == numbers</code></p>
</div>
<div class="paragraph">
<p>The reason I use the left form in C/C++ even when I can use the right is it makes it
more explicit and obvious that I&#8217;m getting the address of an element of an array.
If you were scanning the code quickly and saw the expression on the right, you might
not realize that&#8217;s an address at all, it could just be some mathematical expression
(though the array name would hopefully clue you in if it was picked well).</p>
</div>
<div class="paragraph">
<p>Anyway, back to the MIPS code.  After we get the address of the element we want, we
have to load it.  Since it&#8217;s an array of words (aka 4 byte ints) we can use <code>lw</code>.</p>
</div>
<div class="paragraph">
<p>Finally we add that value to total, increment i, and perform the loop check.</p>
</div>
<div class="paragraph">
<p>Now, I said at the beginning that this was the most literal, direct translation
(not counting the restructuring to a do-while form).  It is not however my preferred
form because it&#8217;s not the simplest or shortest.</p>
</div>
<div class="paragraph">
<p>Rather than calculate the element address every iteration, why not just keep a pointer
to the current element and iterate through the array with it?  In C what we&#8217;re doing
is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span><span class="tok-o">*</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-o">&amp;</span><span class="tok-n">numbers</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
	<span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">do</span> <span class="tok-p">{</span>
		<span class="tok-n">total</span> <span class="tok-o">+=</span> <span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-p">;</span>
		<span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">;</span>
		<span class="tok-n">p</span><span class="tok-o">++</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-p">);</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, we set p to point at the first element and then increment it every
step to keep it pointing at numbers[i].  Again, all mathematical operations on pointers
in C deal in increments of the byte syze of the type, so <code>p++</code> is really adding 1*sizeof(int).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span>	li    $t0, 0     # total = 0
	li    $t1, 0     # i = 0
	la    $t2, numbers   # p = numbers
	li    $t3, 10
sum_loop:
	lw    $t4, 0($t2)    # t4 = *p
	add   $t0, $t0, $t4  # total += *p

	addi  $t1, $t1, 1    # i++
	addi  $t2, $t2, 4    # p++  ie p += sizeof(int)
	blt   $t1, $t3, sum_loop   # while (i &lt; 10)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, that may not look much better, we only saved 1 instuction total, and if we were
looping through a string (aka an array of characters, sizeof(char) == 1) we wouldn&#8217;t
have saved any.  However, imagine if we weren&#8217;t using sll to do the multiply but
mul.  That would take 3 instructions, not 1.  Even mul would take 2.  And we&#8217;d
have to use one of those if we were iterating through an array of structures with
a size that wasn&#8217;t a power of 2.</p>
</div>
<div class="paragraph">
<p>But there is one more variant that you can use that can save a few more instructions.
Instead of using i and i&lt;10 to control the loop, use p and the address just past the
end of the array.  In C it would be this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-kt">int</span><span class="tok-o">*</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-o">&amp;</span><span class="tok-n">numbers</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
	<span class="tok-kt">int</span><span class="tok-o">*</span> <span class="tok-n">end</span> <span class="tok-o">=</span> <span class="tok-o">&amp;</span><span class="tok-n">numbers</span><span class="tok-p">[</span><span class="tok-mi">10</span><span class="tok-p">];</span>
	<span class="tok-kt">int</span> <span class="tok-n">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-k">do</span> <span class="tok-p">{</span>
		<span class="tok-n">total</span> <span class="tok-o">+=</span> <span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-p">;</span>
		<span class="tok-n">p</span><span class="tok-o">++</span><span class="tok-p">;</span>
	<span class="tok-p">}</span> <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">p</span> <span class="tok-o">&lt;</span> <span class="tok-n">end</span><span class="tok-p">);</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also use != instead of &lt;.  This is similar to using the .end() method on many C++
data structures when using iterators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><pre><span></span>	li    $t0, 0     # total = 0
	la    $t2, numbers   # p = numbers
	addi  $t3, $t2, 40   # end = &amp;numbers[10] = numbers + 10*sizeof(int)
sum_loop:
	lw    $t4, 0($t2)    # t4 = *p
	add   $t0, $t0, $t4  # total += *p

	addi  $t2, $t2, 4    # p++  ie p += sizeof(int)
	blt   $t2, $t3, sum_loop   # while (p &lt; end)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we dropped from 10 to 7 and even more if we had had to do mul or mult originally.
And this was just for a 1D array.  Imagine if you had 2 or 3 indices you had to use
to calculate the correct offset.  That&#8217;s in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2d_arrays">2D Arrays</h4>
<div class="paragraph">
<p>The first thing to understand is what&#8217;s really happening when you declare a 2D
array in C.  The contents of a 2D array are tightly packed, in row-major order,
meaning that all the elements from the first row are followed by all the elements
of the second row and so on.  What this means is that a 2D array is equivalent
to a 1D array with rows*cols elements in the same order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-c1">// The memory of these two arrays are identical</span>
	<span class="tok-kt">int</span> <span class="tok-n">array2d</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">][</span><span class="tok-mi">4</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-p">{</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span> <span class="tok-p">},</span> <span class="tok-p">{</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span> <span class="tok-p">}</span> <span class="tok-p">};</span>
	<span class="tok-kt">int</span> <span class="tok-n">array1d</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span> <span class="tok-p">};</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the code example 2d_arrays.c for more details.</p>
</div>
<div class="paragraph">
<p>What this means is that when we declare a 2D array, it&#8217;s basically a 1D array with
the size equal to the rows * columns.  Also when we loop through a 2D array, we can
often treat it like a 1D array with a single loop.  So everything that we learned
before applies.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">&lt;</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-o">++</span><span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-n">array</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">][</span><span class="tok-n">j</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-n">j</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>

	<span class="tok-c1">// becomes</span>

	<span class="tok-kt">int</span> <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">;</span>
	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">rows</span><span class="tok-o">*</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">/</span> <span class="tok-n">cols</span><span class="tok-p">;</span>
		<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">%</span> <span class="tok-n">cols</span><span class="tok-p">;</span>
		<span class="tok-n">array</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">r</span> <span class="tok-o">+</span> <span class="tok-n">c</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>So assuming rows and cols are in a0 and a1 (and nonzero), it&#8217;d look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><pre><span></span>	la    $t0, array    # p = &amp;array[0]
	li    $t1, 0        # i = 0
	mult  $a0, $a1      # a0 = rows, a1 = cols
	mflo  $t2           # t2 = rows * cols
loop:
	div   $t1, $a1
	mflo  $t3           # r = i / cols
	mfhi  $t4           # c = i % cols
	add   $t3, $t3, $t4    # t3 = r + c

	sw    $t3, 0($t0)      # array[i] = *p = r + c

	addi  $t1, $t1, 1      # i++
	addi  $t0, $t0, 4      # p++ (keep pointer in sync with i, aka p = &amp;array[i])
	blt   $t1, $t2, loop   # while (i &lt; rows*cols)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You might ask if it&#8217;s it worth it to convert it to a single loop when you still
need the original i and j as if you were doing nested loops.  Generally, it is
much nicer to avoid nested loops in assembly if you can.  There are many cases
when you get the best of both worlds though.  If you&#8217;re doing a clear for example,
setting the entire array to a single value, there&#8217;s no need to calculate the row
and column like we did here.  I only picked this example to show how you could
get them back if you needed them.</p>
</div>
<div class="paragraph">
<p>For comparison here&#8217;s the nested translation (while still taking advantage of
the 1D arrangement of memory and pointer iterators):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>	la    $t0, array    # p = &amp;array[0]
	li    $t1, 0        # i = 0
looprows:
	li    $t2, 0        # j = 0
loopcols:
	add   $t3, $t1, $t2    # t3 = i + j
	sw    $t3, 0($t0)      # array[i][j] = *p = i + j

	addi  $t2, $t2, 1         # j++
	addi  $t0, $t0, 4         # p++ (keep pointer in sync with i and j, aka p = &amp;array[i][j])
	blt   $t2, $a1, loopcols  # while (j &lt; cols)

	addi  $t1, $t1, 1          # i++
	blt   $t1, $a0, looprows   # while (i &lt; rows)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s a bit shorter but again, how much are those extra labels and branching worth?
For me, this one&#8217;s a toss up.  On the other hand either of the last 2 versions are
better than the literal translation imo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><pre><span></span>	la    $t0, array    # p = &amp;array[0]
	li    $t1, 0        # i = 0
looprows:
	li    $t2, 0        # j = 0
loopcols:
	add   $t3, $t1, $t2    # t3 = i + j

	# need to calculate the byte offset of element array[i][j]
	mult  $t1, $a1
	mflo  $t4              # i * cols

	add   $t4, $t4, $t2    # t4 = i * cols + j

	sll   $t4  $t4, 2      # t4 = (i * cols + j) * sizeof(int)
	add   $t4, $t4, $t0    $ t4 = &amp;array[i][j] (calculated as array + (i*cols + j)*4)

	sw    $t3, 0($t4)      # array[i][j] = i + j

	addi  $t2, $t2, 1         # j++
	blt   $t2, $a1, loopcols  # while (j &lt; cols)

	addi  $t1, $t1, 1          # i++
	blt   $t1, $a0, looprows   # while (i &lt; rows)
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That chunk in the middle calculating the offset of every element?  Not only is
it far slower than just iterating the pointer through the array, but you can
imagine how much worse it would be for a 3D array with 3 nested loops.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_3">Conclusion</h3>
<div class="paragraph">
<p>Hopefully after those examples you have a more solid understanding of looping in
MIPS and how to transform various loops and array accesses into the form
that makes your life the easiest.  There is more we could cover here, like
looping through a linked list, but I think that&#8217;s beyond the scope of what we&#8217;ve
covered so far.  Perhaps in a later chapter.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_5_functions_and_the_mips_calling_convention">Chapter 5: Functions and the MIPS Calling Convention</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While I&#8217;m sure everyone here probably knows what functions are, and we&#8217;ll cover
them in assembly shortly, you might be wondering what a "Calling Convention" is.
In short, it is an agreement between the caller and callee about how to treat/use
certain registers.  We&#8217;ll get to the why and how later.</p>
</div>
<div class="sect2">
<h3 id="_functions">Functions</h3>
<div class="paragraph">
<p>In assembly, a function is just a label with a return instruction associated with it;
because this is far more ambiguous than a function in a higher level language, it
is good practice to only have a single return instruction associated with a
function.<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>  A comment above the label is also helpful.  Together those help you
quickly see the start and end of the function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><pre><span></span><span class="tok-kt">void</span> <span class="tok-nf">func1</span><span class="tok-p">()</span> <span class="tok-p">{}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><pre><span></span># void func1()
func1:
	# body goes here
	jr     $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see my policy is to put a single line comment of the C prototype above
label.</p>
</div>
<div class="paragraph">
<p>But how do you call a function in assembly?  You use the opcode <code>jal func_label</code>.
Let&#8217;s change the hello world program from chapter 0 to call a function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><pre><span></span>.data
hello:   .asciiz &quot;Hello World!\n&quot;

.text
main:
	jal  hello_world

	li   $v0, 10     # exit syscall
	syscall


# void hello_world()
hello_world:
	li   $v0, 4      # print string system call
	la   $a0, hello  # load address of string to print into a0
	syscall

	jr  $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The op <code>jal</code> stands for "jump and link".  What it actually does is save the
address of the next instruction to <code>$ra</code> and then do an unconditional jump
to the function label.  So you could achieve the same results with the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	jal    func

	# is equivalent to

	la     $ra, next_instr
	j      func
next_instr:</pre>
</div>
</div>
<div class="paragraph">
<p>That would get tiring and ugly fast though, having to come up with unique labels
for the next instruction every time.  You also might be confused about why the
greensheet says jal saves PC+8 in <code>$ra</code> instead of PC+4.  The reason for that
is that MIPS technically has delayed branching, i.e. a single instruction after
every branch instruction is executed before the jump actually happens.  So jal
adds 8 instead of 4 to account for that extra instruction delay.  However,
every simulator we&#8217;ve mentioned does non-delayed branching by default so you
can ignore it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_convention">The Convention</h3>
<div class="paragraph">
<p>We&#8217;ve gone as far as we can without starting to talk about registers and their
purposes in functions.  You can think about registers as variables<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup> that
are part of the CPU.  In this case, since we&#8217;re dealing with a 32-bit MIPS
architecture, they are 4 byte/word variables.  Since they&#8217;re part of the CPU,
they exist for the life of the program and the whole program shares the same
registers.</p>
</div>
<div class="paragraph">
<p>But how does that work?  If all parts of the program use the same
32 registers, how does one function not stomp all over what another was doing
when they use them?  In fact, how do functions communicate at all?  How do they
pass arguments or return results?  All these questions are solved by deciding
on a "Calling Convention".  It&#8217;s different for different architectures and even
different operating systems on the same architecture.  This is because different
architectures have different numbers of registers, and some registers like <code>$ra</code>
have hardcoded uses.  The op <code>jal</code> modifies <code>$ra</code> and <code>$0</code> is a constant 0 and
there&#8217;s no way to change either of those facts.  That still leaves a lot of
flexibility about designing a calling convention.  While they mostly match,
you&#8217;ll find several variations of MIPS calling conventions online.  They
usually differ in how they setup a stack frame.  The convention covered
in this chapter is consistent with, and sufficient for almost every college
course I&#8217;ve ever heard of.</p>
</div>
<div class="paragraph">
<p>Regardless, what matters, is that the calling convention works by setting rules
(and guidelines) for register use, and when/how to use the stack.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re unfamiliar with the
runtime stack, it&#8217;s exactly what it sounds like.  It&#8217;s a First-In-Last-Out (FILO)
data structure that you can use to store smaller values in a program.  It grows
in a negative direction, so to allocate 12 bytes, you would subtract 12 from the
stack pointer (in MIPS that&#8217;s <code>$sp</code>).</p>
</div>
<div class="paragraph">
<p>MIPS specifically, designates certain registers to be used for passing arguments
(at least the first 4), others for return values, and others as misc temporary
saved respectively.  The rest are special use registers like <code>$ra</code>.</p>
</div>
<div class="paragraph">
<p>The quickest way to summarize is to look at the table
on the greensheet which is reproduced (with some modifications) below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. MIPS Registers and Uses</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Number</th>
<th class="tableblock halign-left valign-top">Use</th>
<th class="tableblock halign-left valign-top">Preserved Across a Call</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N.A.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembler Temporary (used to expand pseudo-ops)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$v0-$v1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function Results and Expression Evaluation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$a0-$a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$t0-$t7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$s0-$s7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saved Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$t8-$t9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$k0-$k1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26-27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for OS Kernel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$gp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Pointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$sp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack Pointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$fp (or $s8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frame Pointer if necessary or can be another saved reg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$ra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To summarize, you have 16 registers that can be used anytime for temporary
values, though some have special uses too (the v, a and t registers).
You have 8 s registers that have to be saved on the stack if you use
them, plus <code>$ra</code> as well.  The <code>$zero</code> register is obviously a special case.</p>
</div>
<div class="paragraph">
<p>The <code>$sp</code> register is technically preserved but not in the same way.  Basically
what you allocate (subtract) you have to deallocate (add) before returning
from a function, thus preserving the original value.</p>
</div>
<div class="paragraph">
<p>You can ignore <code>$at, $k0-$k1, $gp</code> and most of the time <code>$fp</code> too.  In 5 years
of tutoring I&#8217;ve helped students with MIPS from at least 2 dozen different colleges
and I think a professor I&#8217;ve only seen a professor force his students to use <code>$fp</code>
or pass more than 4 arguments twice.  I&#8217;ve actually seen<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup> register 30 referred to
as <code>$s8</code> rather than, or in addition to, <code>$fp</code> which shows you how rarely it&#8217;s
actually used as a frame pointer.</p>
</div>
<div class="sect3">
<h4 id="_basic_example">Basic example</h4>
<div class="paragraph">
<p>Let&#8217;s start with something simple that doesn&#8217;t use the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>int hello_name_number(char* name, int number)
{
	printf("Hello %s!\n", name);
	return number*10;
}</pre>
</div>
</div>
<div class="paragraph">
<p>According to the convention that becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.data
hello_space:  .asciiz "Hello "
exclaim_nl:   .asciiz "!\n"

.text
#int hello_name_number(char* name, int number)
hello_name_number:
	move    $t0, $a0   # save name in t0 since we need a0 for the syscall

	li      $v0, 4        # print string
	la      $a0, hello_space
	syscall

	move      $a0, $t0    # print name (v0 is still 4)
	syscall

	la        $a0, exclaim_nl
	syscall


	addi    $v0, $a1, 10  # return number+10
	jr      $ra</pre>
</div>
</div>
<div class="paragraph">
<p>Some things to note, syscalls are not function calls, so we can "save" <code>$a0</code> in
a t register and know that it&#8217;ll still be there when the syscall is done.  In the
same way, we know that <code>$v0</code> is still the same so we don&#8217;t have to keep setting
it to 4 for print string.  Lastly, to return a value, we just make sure that value
is in <code>$v0</code> before returning.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_stack">Using the Stack</h4>
<div class="paragraph">
<p>Ok first let&#8217;s establish the rules on when you <em>have</em> to use the stack (You can
always use it for arbitrary local variables, like a local array for example but
generally don&#8217;t if you don&#8217;t have a good reason).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You call another function, ie you&#8217;re a non-leaf function.</p>
<div class="paragraph">
<p>This means you have to save <code>$ra</code> on the stack at the very least, otherwise when you
do your <code>jr $ra</code> you&#8217;d jump back into yourself (right after the last jal instruction).
This does not apply to main because you don&#8217;t/shouldn&#8217;t return from main, you should
call the exit (or exit2) syscall (10 or 17).</p>
</div>
</li>
<li>
<p>You need to save values across a function call (automatically includes reason 1).</p>
<div class="paragraph">
<p>This is fairly common for non-trivial functions. Obvious examples are calling a
function in a loop or loops (you&#8217;d have to preserve the iterator(s), and
many recursive functions.</p>
</div>
</li>
<li>
<p>You run out of temporary registers and overflow into the s registers.</p>
<div class="paragraph">
<p>This is very rare.  The most common reason this "happens" is people forget they have
10 t registers instead of 8 like s registers and even if they remember that they
forget they can also use the a and v registers for temporaries.  16 is more than
enough to handle pretty much any function because you rarely need 17 discrete values
at the same time.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ok let&#8217;s look at an example for the first two.  Any example for the last rule
would be prohibitively large/complicated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><pre><span></span><span class="tok-kt">int</span> <span class="tok-nf">non_leaf</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
	<span class="tok-n">func1</span><span class="tok-p">();</span>
	<span class="tok-k">return</span> <span class="tok-mi">42</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This just calls the empty function discussed at the top of this chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><pre><span></span>#int non_leaf()
non_leaf:
	addi    $sp, $sp, -4  # space to save 1 register, $ra
	sw      $ra, 0($sp)

	jal     func1

	li      $v0, 42       # return 42

	lw      $ra, 0($sp)   # restore original $ra
	addi    $sp, $sp, 4   # pop the stack
	jr      $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The bit of code at the top and bottom of the function are called the prologue
and the epilogue for obvious reasons.  You can see how we allocate 4 bytes on
the stack by subtracting 4 (I add a negative rather than subtract, both
because I can copy-paste the line with a single character change for the
epilogue).  Then we store the current <code>$ra</code> in that space at the new top of the
stack.  Then before we exit we have to load it back and pop the stack.</p>
</div>
<div class="paragraph">
<p>If we didn&#8217;t save and restore <code>$ra</code> we would jump to line 7 when we do our
<code>jr $ra</code> and then we&#8217;d be in an infinite loop.</p>
</div>
<div class="paragraph">
<p>Next we have the second case, where we need to preserve regular local values
across a function call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><pre><span></span><span class="tok-kt">void</span> <span class="tok-nf">print_letters</span><span class="tok-p">(</span><span class="tok-kt">char</span> <span class="tok-n">letter</span><span class="tok-p">,</span> <span class="tok-kt">int</span> <span class="tok-n">count</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">count</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">putchar</span><span class="tok-p">(</span><span class="tok-n">letter</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
	<span class="tok-n">putchar</span><span class="tok-p">(</span><span class="tok-sc">&#39;\n&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">save_vals</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-mi">10</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">print_letters</span><span class="tok-p">(</span><span class="tok-sc">&#39;A&#39;</span><span class="tok-o">+</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-mi">8</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That becomes this in mips:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><pre><span></span>#void print_letters(char letter, int count)
print_letters:
	ble     $a1, $0, exit_pl
	li      $v0, 11            # print character
pl_loop:
	syscall
	addi    $a1, $a1, -1       # count--
	bgt     $a1, $0, pl_loop   # while (count &gt; 0)

	li      $a0, 10            # &#39;\n&#39;
	syscall

exit_pl:
	jr      $ra


#int save_vals()
save_vals:
	addi    $sp, $sp, -12
	sw      $ra, 0($sp)
	sw      $s0, 4($sp)
	sw      $s1, 8($sp)

	li      $s0, 0  # i = 0
	li      $s1, 10
sv_loop:
	addi    $a0, $s0, 65   # i + &#39;A&#39;
	addi    $a1, $s0, 1    # i + 1
	jal     print_letters

	addi    $s0, $s0, 1        # i++
	blt     $s0, $s1, sv_loop  # while (i &lt; 10)

	lw      $ra, 0($sp)
	lw      $s0, 4($sp)
	lw      $s1, 8($sp)
	addi    $sp, $sp, 12
	jr      $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that for print_letters, we not only convert the loop to a do-while, but
we also use the parameter count as the iterator to count down to 0.  It saves
us an instruction initializing an i.</p>
</div>
<div class="paragraph">
<p>Secondly, for save_vals, we save not only <code>$ra</code> because we call another function,
but also two s registers to save i and our stopping point.  The second is not
actually necessary.  Because it&#8217;s a constant, we could just load 10 into a register
right before the check every iteration of the loop.  Which is better depends on
several factors, like how long/complex the loop is, how many times it executes, and
of course personal preference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recursive_functions">Recursive Functions</h4>
<div class="paragraph">
<p>Let&#8217;s do a classic recursive function, the fibonacci sequence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><pre><span></span><span class="tok-kt">int</span> <span class="tok-nf">fib</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">n</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
		<span class="tok-k">return</span> <span class="tok-n">n</span><span class="tok-p">;</span>

	<span class="tok-k">return</span> <span class="tok-n">fib</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-mi">-2</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-n">fib</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-mi">-1</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how at the very least, we&#8217;ll have to save <code>$ra</code> and n because we
need the original even after the first recursive fib call.  It&#8217;s not as
obvious but we&#8217;ll also have to save the return value of the first call so
we&#8217;ll still have it to do the addition after the second.  You might think
this would require using two s regs, but does it?  Let&#8217;s see&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><pre><span></span>#int fib(int n)
fib:
	addi    $sp, $sp, -8
	sw      $ra, 0($sp)
	sw      $s0, 4($sp)

	move    $v0, $a0        # prepare to return n
	li      $t0, 1
	ble     $a0, $t0, exit_fib  # if (n &lt;= 2) goto exit_fib (ie return n)

	move    $s0, $a0        # save n

	addi    $a0, $a0, -2
	jal     fib             # fib(n-2)

	addi    $a0, $s0, -1    # prep arg first so we can use s0 to save v0
	move    $s0, $v0        # save return of fib(n-2) in s0
	jal     fib             # fib(n-1)

	add     $v0, $v0, $s0   #  v0 = fib(n-1) + fib(n-2)

exit_fib:
	lw      $ra, 0($sp)
	lw      $s0, 4($sp)
	addi    $sp, $sp, 8
	jr      $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how we don&#8217;t have to save n any sooner than necessary, ie right before
we have to use a0 to setup the first recursive call.  Also the ordering of
lines 16 and 17 is important.  We needed the original n to calculate n-1 but
once that&#8217;s in <code>$a0</code> ready for the call, because we won&#8217;t need n again afterward
we can now use <code>$s0</code> to preserve the return value of the first call.</p>
</div>
<div class="paragraph">
<p>Some of you, if you were paying attention, might point out that you could save
a few instructions of performance if you moved the base case testing before the
prologue as long as you put the exit label after the epilogue.  This is true,
but I&#8217;d recommend against it unless you were really trying to eke out every last
microsecond.  It&#8217;s just nicer/cleaner to keep the prologue and epilogue as the
first and last thing; they&#8217;re one more thing to catch your eye and help delineate
where functions start and end.  Regardless, if you&#8217;re curious, you can see that
version, along with every other function in this chapter in the included program
calling.s.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_4">Conclusion</h3>
<div class="paragraph">
<p>While grasping the basics of a calling convention is not too difficult, it takes
practice to get used to it and there are many things that we haven&#8217;t covered
in this chapter, like how to pass more than 4 arguments or use <code>$fp</code> or handle
floating point arguments or return values.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_6_floating_point_types">Chapter 6: Floating Point Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Up to this point we haven&#8217;t really mentioned floating point values or instructions
at all, except how to declare them in the <code>.data</code> section and the syscalls for
reading and printing them.  There are two reasons we&#8217;ve left them alone till now.
First, they use a whole separate set of registers and opcodes.  Secondly, and
partly because of the first reason, most MIPS college courses do not ever require
you to know or use floating point values.  Since this book is targeted at college
students, if you know you won&#8217;t need to know this feel free to skip this chapter.</p>
</div>
<div class="sect2">
<h3 id="_floating_point_registers_and_instructions">Floating Point Registers and Instructions</h3>
<div class="paragraph">
<p>While the greensheet contains a nice table for the normal registers it is completely
lacking for the floating point registers.  There are 32 32-bit floating point registers.
You can use them all for floats but they&#8217;re are paired even-odd for doubles.  In other
words you can only use even numbers for doubles, because storing a double at $f0 actually
uses $f0 and $f1 because it takes 64 bits/8 bytes.</p>
</div>
<div class="paragraph">
<p>As far as the calling conventions for floating point registers, it is actually hard
to find anything definitive even for the basics.  Obviously you could make up your own
but the float/double syscalls, and the tiny code snippet in Patterson and Hennessy were
at least consistent with this old website so I&#8217;ll go with that.  I have seen at least
one course page where the prof wanted <em>all</em> float registers preserved which seems
excessive and ridiculous but prof&#8217;s are gonna prof.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. MIPS Floating Point Registers and Uses</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Use</th>
<th class="tableblock halign-left valign-top">Preserved Across a Call</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f0-$f2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function Results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f4-$f10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f12-f14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f16-f18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$f20-f30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saved Temporaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This table is based on doubles so it may look like it&#8217;s skipping odd registers but
they&#8217;re included where the even they&#8217;re paired with is.  So, for example you actually
have 4 registers for float arguments <code>$f12</code> through <code>$f15</code> but only 2 for doubles
<code>$f12</code> and <code>f14</code>.  Similarly you have 12 saved registers for floats but 6 for doubles.</p>
</div>
<div class="paragraph">
<p>Most of the next table is actually on the Greensheet but not all of it and I thought
it worth reproducing here.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. MIPS floating point instructions (and pseudoinstructions)</caption>
<colgroup>
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Opcode</th>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load Word to Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lwc1 (or l.s)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lwc1 ft, n(rs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[ft] = M[R[rs]+n]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store Word from Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">swc1 (or s.s)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">swc1 ft, n(rs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M[R[rs]+n] = F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load Double to Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldc1 (or l.d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldc1 ft, n(rs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[ft] = M[R[rs]+n]; F[ft+1] = M[R[rs]+n+4]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store Double from Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sdc1 (or s.d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sdc1 ft, n(rs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M[R[rs]+n] = F[ft]; M[R[rs]+n+4] = F[ft+1]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move From Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mfc1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mfc1 rd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R[rd] = F[fs]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move To Coprocessor 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtc1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtc1 rd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fs] = R[rd]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert Word To Single Precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.s.w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.s.w fd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = (float)F[fs]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert Single Precision To Word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.w.s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.w.s fd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = (int)F[fs]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert Word To Double Precision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.d.w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.d.w fd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = (double)F[fs]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert Double Precision To Word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.w.d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cvt.w.d fd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = (int)F[fs]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch on FP True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1t label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (FPcond) goto label;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch on FP False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bc1f label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (!FPcond) goto label;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FP Compare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.<em>y</em>.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c.<em>y</em>.<em>x</em> fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPcond = (F[fs] op F[ft]) ? 1 : 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abs.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abs.x fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fs] = (F[ft] &gt; 0) ? F[ft] : -F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add.x fd, fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = F[fs] + F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub.x fd, fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = F[fs] - F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mul.x fd, fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = F[fs] * F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Divide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">div.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">div.x fd, fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = F[fs] / F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neg.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neg.x fs, ft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fs] = -F[ft]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mov.<em>x</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mov.x fd, fs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F[fd] = F[fs]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With all of the opcodes that end in .<em>x</em>, the x is either s for single
precision or d for double precision.</p>
</div>
<div class="paragraph">
<p>The <em>y</em> in the Compare instructions are one of eq, ne, lt, le, gt, ge.  Since
only (eq, lt, and le are on the greensheet it&#8217;s safe to assume the other 3 are
pseudoinstructions).  Naturally op would be the matching ==, !=, &lt;, &#8656;, &gt;, or &gt;=.</p>
</div>
</div>
<div class="sect2">
<h3 id="_practice_2">Practice</h3>
<div class="paragraph">
<p>We&#8217;re going to briefly go over some of the more different aspects of dealing
with floating point numbers but since most of it is the same with just a different
set of registers and calling convention, we won&#8217;t be rehashing most concepts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_floating_point_literals">Getting Floating Point Literals</h3>
<div class="paragraph">
<p>The first think to know when dealing with floats is how to actually get float
(or double) literals into registers where you can actually operate on them.</p>
</div>
<div class="paragraph">
<p>There are 2 ways.  The first, and simpler way is to just declare them as globals
and then use the <code>lwc1</code> or <code>ldw1</code> instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>.data
a:     .float 3.14159
b:     .double 1.61

.text
main:

	la      $t0, a
	lwc1    $f0, 0($t0)   # get a into $f0

	la      $t0, b
	ldc1    $f2, 0($t0)   # get b into $f2-3

	# other code here
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second way is to use the regular registers and convert the values.  Of course
this means unless you want a whole value, you&#8217;d have to actually do it twice
and divide.  It looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><pre><span></span>	mtc1    $0, $f0     # move 0 to $f0 (0 integer == 0.0 float)

	# get 4 to 4.0 in $f2
	li       $t0, 4
	mtc1     $t0, $f2
	cvt.s.w  $f2, $f2   # convert 4 to 4.0
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, other than 0 which is a special case, it requires at least 3
instructions, more than the 2 (or 1 if you load directly from the address) of
the first method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_branching">Branching</h3>
<div class="paragraph">
<p>Branching based on floating point values is slightly different than normal.  Instead
of being able to test and jump in a single convenient instruction, you hav to test
first and then jump in a second instruction if the test was true or not.  This is the
same way x86 does it.  The test sets a special control/flag register (or a certain
bit or bits in the register) and then all jumps are based on its state.</p>
</div>
<div class="paragraph">
<p>Using it looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><pre><span></span>	c.lt.s  $f0, $f2   # fpcond = f0 &lt; f2
	bc1t    was_less   # if (f0 &lt; f2) goto was_less

	# do something for f0 &gt;= f2

	j       blah
was_less:

	# do something for f0 &lt; f2

blah:
</pre></td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functions_2">Functions</h3>
<div class="paragraph">
<p>Lastly, lets do a simple example of writing a function that takes a float and
returns a float.  I&#8217;m not going to bother doing one for doubles because it&#8217;d
be effectively the same, or doing one that requires the stack, because the only
difference from normal is a new set of registers and knowing which ones to save
or not from the table above.</p>
</div>
<div class="paragraph">
<p>So, how about a function to convert a fahrenheit temperature to celsius:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><pre><span></span>.data

# 5/9 = 0.5 with 5 repeating
fahrenheit2celsius: .float 0.5555555

.text
# float convert_F2C(float degrees_f)
convert_F2C:
	la      $t0, fahrenheit2celsius
	lwc1    $f0, 0($t0)    # get conversion factor

	# C = (F - 32) * 5/9
	li      $t0, 32
	mtc1    $t0, $f1       # move int 32 to f1
	cvt.s.w $f1, $f1      # convert to 32.0


	sub.s   $f12, $f12, $f1  # f12 = degrees - 32

	mul.s   $f0, $f0, $f12  # f0 = 0.555555 * f12

	jr     $ra
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see we follow the convention with the argument coming in f12 and the
result being returned in f0.  In this function we use both methods for getting
a value into float registers; one we load from memory and the other, being
an integer, we move and convert.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_5">Conclusion</h3>
<div class="paragraph">
<p>As I said before, it is rare for courses to even bother covering floating point
instructions or assign any homework or projects that use it, but hopefully this
brief overview, combined with the knowledge of previous ones is sufficient.</p>
</div>
<div class="paragraph">
<p>There are also 2 example programs conversions.s and calc_pi.s for you to study.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_7_tips_and_tricks">Chapter 7: Tips and Tricks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is a grab bag of things you can do to improve your MIPS
programs and make your life easier.</p>
</div>
<div class="sect2">
<h3 id="_formatting">Formatting</h3>
<div class="paragraph">
<p>You may have noticed I have a general format I like to follow when writing
MIPS (or any) assembly.  The guidelines I use are the following</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>1 indent for all code excluding labels/macros/constants.</p>
<div class="paragraph">
<p>I use hard tabs set to a width of 4 but it reall doesn&#8217;t matter as long as
it&#8217;s just 1 indent according to your preferences.</p>
</div>
</li>
<li>
<p>Use <strong>spaces</strong> to align the first operand of all instructions (syscall obviously</p>
<div class="paragraph">
<p>doesn&#8217;t have any) out far enough.  Given my 4 space tabs, this usually means column
11-13 for me.  The reason to use spaces is to prevent the circumstances that gave
hard tabs a bad name.  When you use hard tabs for alignment, rather than indentation,
and then someone else opens your code with their tab set to a different width,
suddenly everything looks like crap.  Tabs for indentation, spaces for alignment.
Or as is increasingly common (thanks Python), spaces for everything but I refuse
to do that to the poor planet.{green_tabs}</p>
</div>
</li>
<li>
<p>A comma and a single space between operands.  The simulators don&#8217;t actually</p>
<div class="paragraph">
<p>require the comma but since other assembly languages/assemblers do, you might
as well get used to it.  Besides I think it&#8217;s easier to read with the comma,
though that might just be me comparing it to passing arguments to a function.</p>
</div>
</li>
<li>
<p>Comment every line or group of closely related lines with the purpose,</p>
<div class="paragraph">
<p>often just the equivalent C code.  You can relax this a little as you get
more experience.</p>
</div>
</li>
<li>
<p>Use a blank line to separate logically grouped lines of code.  While you</p>
<div class="paragraph">
<p>can smash everything together vertically, I definitely wouldn&#8217;t recommend it,
even less than I would in a higher level language.</p>
</div>
</li>
<li>
<p>Put the <code>.data</code> section at the top, similar to declaring globals in C.</p>
<div class="paragraph">
<p>There are exceptions for this.  When dealing with a larger program with lots
of strings, it can be convienent to have multiple <code>.data</code> sections with the
strings you&#8217;re using declared close to where you use them.  The downside is
you have to keep swapping back and forth between <code>.text</code> and <code>.data</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_misc_general_tips">Misc. General Tips</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Try to use registers starting from 0 and working your way up.  It helps</p>
<div class="paragraph">
<p>you keep track of where things are (esp. combined with the comments). This
obviously can fall apart when you discover you forgot something or need to
modify the code later and it&#8217;s often not worth changing all the registers
you&#8217;re already using just so you have that nice sequence.  When that happens
I&#8217;ll sometimes just pick the other end of sequence (ie <code>$t9</code> or <code>$s7</code>) since
if it&#8217;s out of order I might as well make it obvious.</p>
</div>
</li>
<li>
<p>Minimize your jumps, labels, and especially your level of nested loops.</p>
<div class="paragraph">
<p>This was already covered in the chapters on branching and loops but it bears
repeating.</p>
</div>
</li>
<li>
<p>In your prologue save <code>$ra</code> first (at the top of the stack) if necessary</p>
<div class="paragraph">
<p>and all s regs you used (starting at <code>$s0</code>) in order going down.  Then copy
paste the whole thing to the bottom, move the first line to the bottom and
change the number to positive and change all the <code>sw</code> to <code>lw</code>.</p>
</div>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>func:
	addi    $sp, $sp, -20
	sw      $ra, 0($sp)
	sw      $s0, 4($sp)
	sw      $s1, 8($sp)
	sw      $s2, 12($sp)
	sw      $s3, 16($sp)

	# body of func here that calls another function or functions
	# and needs to preserve 4 values across at least one of those calls

	lw      $ra, 0($sp)
	lw      $s0, 4($sp)
	lw      $s1, 8($sp)
	lw      $s2, 12($sp)
	lw      $s3, 16($sp)
	addi    $sp, $sp, 20</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constants">Constants</h3>
<div class="paragraph">
<p>One of the easiest things you can do to make your programs more readable
is use defined constants in your programs.  Both MARS and SPIM have ways
of defining constants similar to how C defines macro constants; ie they
aren&#8217;t "constant variables" that take up space in memory, it&#8217;s as if a
search+replace was done on them right before assembling the program.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at our Hello World program using constants for SPM and MARS</p>
</div>
<div class="paragraph">
<p>SPIM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>sys_print_str = 4
sys_exit = 10

.data
hello:   .asciiz &quot;Hello World!\n&quot;

.text
main:
	li      $v0, sys_print_str
	la      $a0, hello  # load address of string to print into a0
	syscall

	li      $v0, sys_exit
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>MARS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><pre><span></span>.eqv sys_print_str 4
.eqv sys_exit 10

.data
hello:   .asciiz &quot;Hello World!\n&quot;

.text
main:
	li      $v0, sys_print_str
	la      $a0, hello  # load address of string to print into a0
	syscall

	li      $v0, sys_exit
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_macros">Macros</h3>
<div class="paragraph">
<p>MARS supports function style macros that can shorten your code and improve
readability in some cases (though I feel it can also make it worse or be a wash).</p>
</div>
<div class="paragraph">
<p>The syntax looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><pre><span></span>.macro macroname
instr1  a, b, c
instr2, b, d
# etc.
.end_macro

# or with parameters
.macro macroname(%arg1)
instr1    a, %arg1
instr2    c, d, e
# etc.
.end_macro
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some common examples are using them to print strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><pre><span></span>.macro print_str_label(%x)
li     $v0, 4
la     $a0, %x
syscall
.end_macro

.macro print_str(%str)
.data
str: .asciiz %str
.text
li     $v0, 4
la     $a0, str
syscall
.end_macro

.data

str1:   .asciiz &quot;Hello 1\n&quot;

.text
# in use:
	print_str_label(str1)

	print_str(&quot;Hello World\n&quot;)

	...
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see an example program in macros.s</p>
</div>
<div class="paragraph">
<p>Unfortunately, as far as I can tell SPIM does not support function style macros
despite what MARS&#8217;s documentation implies about using a $ instead of a % for arguments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_switch_case_statements">Switch-Case Statements</h3>
<div class="paragraph">
<p>It is relatively common in programming to have to compare a integral type variable
(ie basically any built in type but float and double) against a bunch of different
constants and do something different based on what it matches or if it matches none.</p>
</div>
<div class="paragraph">
<p>This could be done with a long if-else-if chain, but the longer the chain the more
likely the programmer is to choose a switch-case statement instead.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a pretty short/simple example in C:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><pre><span></span>	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter your grade (capital): &quot;</span><span class="tok-p">);</span>
	<span class="tok-kt">int</span> <span class="tok-n">grade</span> <span class="tok-o">=</span> <span class="tok-n">getchar</span><span class="tok-p">();</span>
	<span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-n">grade</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">case</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Excellent job!&quot;</span><span class="tok-p">);</span> <span class="tok-k">break</span><span class="tok-p">;</span>
	<span class="tok-k">case</span> <span class="tok-sc">&#39;B&#39;</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Good job!&quot;</span><span class="tok-p">);</span> <span class="tok-k">break</span><span class="tok-p">;</span>
	<span class="tok-k">case</span> <span class="tok-sc">&#39;C&#39;</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;At least you passed?&quot;</span><span class="tok-p">);</span> <span class="tok-k">break</span><span class="tok-p">;</span>
	<span class="tok-k">case</span> <span class="tok-sc">&#39;D&#39;</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Probably should have dropped it...&quot;</span><span class="tok-p">);</span> <span class="tok-k">break</span><span class="tok-p">;</span>
	<span class="tok-k">case</span> <span class="tok-sc">&#39;F&#39;</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Did you even know you were signed up for the class?&quot;</span><span class="tok-p">);</span> <span class="tok-k">break</span><span class="tok-p">;</span>
	<span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;You entered and invalid grade!&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could translate this to its eqivalent if-else chain and handle it just like we
cover in the chapter on branching.  However, imagine if this switch statment had
a dozen cases, two dozen etc.  The MIPS code for that quickly becomes long and ugly.</p>
</div>
<div class="paragraph">
<p>So what if we implemented the switch in MIPS the same way it is semantically in C?
The same way compilers often (but not necessarily) use?  Well before we do that,
what is a switch actually doing?  It is <em>jumping</em> to a specific case label based
on the value in the specified variable.  It then starts executing, falling through
any other labels, till it hits a <code>break</code> which will jump to the end of the switch
block.  If the value does have its own case label, it will jump to the default
label.</p>
</div>
<div class="paragraph">
<p>Compilers handle it by creating what&#8217;s called a jump table, basically an array
of label addresses and using the variable to calculate an index in the table
to use to jump to.</p>
</div>
<div class="paragraph">
<p>The C eqivalent of that would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><pre><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;stdio.h&gt;</span><span class="tok-cp"></span>


<span class="tok-c1">// This compiles with gcc, uses non-standard extension</span>
<span class="tok-c1">// https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">()</span>
<span class="tok-p">{</span>

	<span class="tok-c1">// jump table</span>
	<span class="tok-kt">void</span><span class="tok-o">*</span> <span class="tok-n">switch_table</span><span class="tok-p">[]</span> <span class="tok-o">=</span>
	<span class="tok-p">{</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">a_label</span><span class="tok-p">,</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">b_label</span><span class="tok-p">,</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">c_label</span><span class="tok-p">,</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">d_label</span><span class="tok-p">,</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">default_label</span><span class="tok-p">,</span> <span class="tok-o">&amp;&amp;</span><span class="tok-n">f_label</span> <span class="tok-p">};</span>

	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter your grade (capital): &quot;</span><span class="tok-p">);</span>
	<span class="tok-kt">int</span> <span class="tok-n">grade</span> <span class="tok-o">=</span> <span class="tok-n">getchar</span><span class="tok-p">();</span>
	<span class="tok-n">grade</span> <span class="tok-o">-=</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-p">;</span>  <span class="tok-c1">// shift to 0</span>

	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">grade</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-n">grade</span> <span class="tok-o">&gt;</span> <span class="tok-sc">&#39;F&#39;</span><span class="tok-o">-</span><span class="tok-sc">&#39;A&#39;</span><span class="tok-p">)</span>
		<span class="tok-k">goto</span> <span class="tok-n">default_label</span><span class="tok-p">;</span>

	<span class="tok-k">goto</span> <span class="tok-o">*</span><span class="tok-n">switch_table</span><span class="tok-p">[</span><span class="tok-n">grade</span><span class="tok-p">];</span>

<span class="tok-nl">a_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Excellent job!&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">end_switch</span><span class="tok-p">;</span>

<span class="tok-nl">b_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Good job!&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">end_switch</span><span class="tok-p">;</span>

<span class="tok-nl">c_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;At least you passed?&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">end_switch</span><span class="tok-p">;</span>

<span class="tok-nl">d_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Probably should have dropped it...&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">end_switch</span><span class="tok-p">;</span>

<span class="tok-nl">f_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;Did you even know you were signed up for the class?&quot;</span><span class="tok-p">);</span>
	<span class="tok-k">goto</span> <span class="tok-n">end_switch</span><span class="tok-p">;</span>

<span class="tok-nl">default_label</span><span class="tok-p">:</span>
	<span class="tok-n">puts</span><span class="tok-p">(</span><span class="tok-s">&quot;You entered an invalid grade!&quot;</span><span class="tok-p">);</span>


<span class="tok-nl">end_switch</span><span class="tok-p">:</span>


	<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&amp;&amp;</code> and <code>goto *var</code> syntax are actually not standard C/C++ but are GNU
extensions that are supported in gcc (naturally) and clang, possibly others.<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</div>
<div class="paragraph">
<p>Notice how the size of the jump table is the value of the highest valued label
minus the lowest + 1.  That&#8217;s why we subtract the lowest value to shift the range
to start at 0 for the indexing.  Secondly, any values without labels within that
range are filled with the default label address.  Lastly there has to be an initial
check for values outside the range to jump to default otherwise you could get an
error from an invalid access outside of the array&#8217;s bounds.</p>
</div>
<div class="paragraph">
<p>The same program/code in MIPS would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><pre><span></span>.data

a_str:  .asciiz &quot;Excellent job!\n&quot;
b_str:  .asciiz &quot;Good job!\n&quot;
c_str:  .asciiz &quot;At least you passed?\n&quot;
d_str:  .asciiz &quot;Probably should have dropped it...\n&quot;
f_str:  .asciiz &quot;Did you even know you were signed up for the class?\n&quot;

invalid_str:  .asciiz &quot;You entered an invalid grade!\n&quot;

enter_grade:  .asciiz &quot;Enter your grade (capital): &quot;

switch_labels: .word a_label, b_label, c_label, d_label, default_label, f_label

.text

main:

	li      $v0, 4
	la      $a0, enter_grade
	syscall

	li      $v0, 12    # read char
	syscall

	li      $t2, 5    # f is at index 5

	la      $t0, switch_labels
	addi    $t1, $v0, -65   # t1 = grade - &#39;A&#39;
	blt     $t1, $0, default_label   # if (grade-&#39;A&#39; &lt; 0) goto default
	bgt     $t1, $t2, default_label  # if (grade-&#39;A&#39; &gt; 5) goto default

	sll     $t1, $t1, 2     # offset *= 4 (sizeof(word))
	add     $t0, $t0, $t1   # t0 = switch_labels + byte_offset = &amp;switch_labels[grade-&#39;A&#39;]
	lw      $t0, 0($t0)     # load address from jump table
	jr      $t0             # jump to

a_label:
	la      $a0, a_str
	j       end_switch

b_label:
	la      $a0, b_str
	j       end_switch

c_label:
	la      $a0, c_str
	j       end_switch

d_label:
	la      $a0, d_str
	j       end_switch

f_label:
	la      $a0, f_str
	j       end_switch

default_label:
	la      $a0, invalid_str


end_switch:
	li      $v0, 4
	syscall

	li      $v0, 10   # exit
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s easy to forget that <code>jr</code> does not actually stand for "jump return" even though
it&#8217;s almost always used for that purpose.  Instead it stands for "jump register"
and we can use it to do the eqivalent of the computed goto statement in C.</p>
</div>
<div class="paragraph">
<p>While this example probably wasn&#8217;t worth making switch style, because the overhead
and extra code of making the table and preparing to jump balanced out or even
outweighed the savings of a branch instruction for every case, as the number
of options increases, the favor tilts toward using a jump table like this as
long as the range of isn&#8217;t too sparse.  If the range of values is is the 100&#8217;s
or 1000&#8217;s but you only have cases for a dozen or so, then obviously that isn&#8217;t worth
it to create a table that large just to fill it almost entirely with the default label.</p>
</div>
<div class="paragraph">
<p>Just to reiterate, remember it is not about the magnitude of the actual values
you&#8217;re looking for, just the difference between the highest and lowest because
high - low + 1 is the size of your table.</p>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_arguments">Command Line Arguments</h3>
<div class="paragraph">
<p>Command line arguments, also known as program arguments, or command line parameters
are strings that are passed to the program on startup.  In high level languages like
C, they are accessed through the parameters to the main function (naturally):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><pre><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;stdio.h&gt;</span><span class="tok-cp"></span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;There are %d command line arguments:</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">,</span> <span class="tok-n">argc</span><span class="tok-p">);</span>

	<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">argc</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-n">printf</span><span class="tok-p">(</span><span class="tok-s">&quot;%s</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">,</span> <span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]);</span>
	<span class="tok-p">}</span>

	<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, argc contains the number of parameters and argv is an array of
C strings that are those arguments.  If you run this program you&#8217;ll get something
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>$ ./args <span class="tok-m">3</span> random arguments
There are <span class="tok-m">4</span> <span class="tok-nb">command</span> line arguments:
./args
<span class="tok-m">3</span>
random
arguments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the first argument is the what you actually typed to invoke the program,
so you always have at least one argument.</p>
</div>
<div class="paragraph">
<p>MIPS works the same way.  The number of arguments is in <code>a0</code> and an array of strings
is in <code>a1</code> when main starts.  So the same program in MIPS looks like this;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="mips"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><pre><span></span>.data

there_are:  .asciiz &quot;There are &quot;
arguments:  .asciiz &quot; command line arguments:\n&quot;

.text

main:
	move    $t0, $a0  # save argc

	li      $v0, 4
	la      $a0, there_are
	syscall

	move    $a0, $t0
	li      $v0, 1   # print int
	syscall

	li      $v0, 4
	la      $a0, arguments
	syscall

	li      $t1, 0   # i = 0
	j       arg_loop_test

arg_loop:
	li      $v0, 4
	lw      $a0, 0($a1)
	syscall

	li      $v0, 11
	li      $a0, 10    # &#39;\n&#39;
	syscall

	addi    $t1, $t1, 1   # i++
	addi    $a1, $a1, 4    # argv++ ie a1 = &amp;argv[i]
arg_loop_test:
	blt     $t1, $t0, arg_loop  # while (i &lt; argc)

	li      $v0, 10
	syscall
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program works exactly like the C program when using SPIM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>$ spim -file args.s 3 random arguments
SPIM Version 8.0 of January 8, 2010
Copyright 1990-2010, James R. Larus.
All Rights Reserved.
See the file README for a full copyright notice.
Loaded: /usr/lib/spim/exceptions.s
There are 4 command line arguments:
args.s
3
random
arguments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously the commands for SPIM itself are not included but the file name (args.s)
takes the place as the "executable".</p>
</div>
<div class="paragraph">
<p>Unfortunately, MARS works differently, probably because it&#8217;s more GUI focused.  It
does not pass the program/file name as the first argument, so you can actually get
0 arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>$ java -jar ~/Mars4_5.jar args.s pa 3 random arguments
MARS 4.5  Copyright 2003-2014 Pete Sanderson and Kenneth Vollmar

There are 3 command line arguments:
3
random
arguments</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that you have to put "pa" (for "program arguments") to indicate that
the following strings are arguments.  In the GUI, there is an option in
"Settings" called "Program arguments provided to MIPS progam" which if selected will
add a text box above the Text Segment for you to enter in the arguments to be
passed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enable_mars_args.png" alt="enable mars args">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mars_args.png" alt="mars args">
</div>
</div>
</div>
</div>
</div>
<h1 id="_references_and_useful_links" class="sect0">References and Useful Links</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><a href="https://inst.eecs.berkeley.edu/~cs61c/resources/MIPS_Green_Sheet.pdf">Greensheet</a></p>
</li>
<li>
<p><a href="https://courses.missouristate.edu/KenVollmar/mars/Help/SyscallHelp.html">MARS syscall list</a></p>
</li>
<li>
<p><a href="https://learnxinyminutes.com/docs/mips/">learnxinyminutes page</a></p>
</li>
<li>
<p><a href="https://courses.necaise.org/MIPSReference/MIPSReference">Randolph-Macon College MIPS Reference</a></p>
</li>
<li>
<p><a href="https://chortle.ccsu.edu/AssemblyTutorial/index.html">CCSU MIPS Reference</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Starting up the MARS GUI (an old Java app) is often annoyingly slow
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Some schools/professors have their own versions with extra features and other improvements over the old version available on the MARS website
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://courses.missouristate.edu/KenVollmar/mars/Help/MarsHelpCommand.html" class="bare">https://courses.missouristate.edu/KenVollmar/mars/Help/MarsHelpCommand.html</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://courses.missouristate.edu/KenVollmar/mars/Help/SyscallHelp.html" class="bare">https://courses.missouristate.edu/KenVollmar/mars/Help/SyscallHelp.html</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="https://inst.eecs.berkeley.edu/~cs61c/resources/MIPS_Green_Sheet.pdf" class="bare">https://inst.eecs.berkeley.edu/~cs61c/resources/MIPS_Green_Sheet.pdf</a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws" class="bare">https://en.wikipedia.org/wiki/De_Morgan%27s_laws</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. I do not agree with an ironclad "one return" policy in higher level languages.  Sometime returning early results in cleaner code, sometimes not.  Similarly, `goto` is not evil and there are rare cases where using it creates the best code.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. Obviously the zero register is not really a variable.  I never understood how people could say "const variable" with a straight face, it&#8217;s literally an oxymoron.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. It&#8217;s an <a href="https://www.cs.uaf.edu/2000/fall/cs301/notes/notes/node66.html">old link</a>, but not as old as SPIM so maybe using it for a frame pointer was added later
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. <a href="https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html" class="bare">https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.7<br>
Last updated 2021-06-15 19:44:40 -0700
</div>
</div>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #408080; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #FF0000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
pre.pygments .tok-go { color: #888888 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #7D9029 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #A0A000 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</body>
</html>